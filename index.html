<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Assemble</title>
		<script src="http://danml.com/js/download.js"></script>
		<script src="blockly_compressed.js"></script>
		<script src="blocks_compressed.js"></script>
		<script src="msg/js/en.js"></script>
		<script src="blocks/system.js"></script>
		<style>
			.button {
			  border: none;
			  padding: 10px 20px;
			  text-align: center;
			  text-decoration: none;
			  display: inline-block;
			  font-size: 20px;
			  margin: 4px 2px;
			}
			.sidebar {
				float: left;
				position: fixed;
				width: 23%;
				overflow-y: auto;
				top: 0;
				bottom: 0;
				margin: 1%;
				padding-right: 8px;
				font-family: Ebrima, Helvetica, sans-serif;
			}
			body {
				overflow: hidden;
			}
		</style>
	</head>
	<body>
		<div class="row">
			<div class= "sidebar">
				<h1>Assemble</h1>
				<h2>Introduction</h2>
				<p>Welcome to Assemble!</p>
				<p>Designed at the outset for role-playing system designers, Assemble is a content-authorship tool which allows for RPG designers to plan and write <i>Powered by the Apocalypse</i> (PbtA) systems.</p>
				<p style="font-size: small;">Assemble is an open-source web application written in JavaScript and <a href="https://developers.google.com/blockly">Built with Blockly</a>.  View Assemble on <a href="https://github.com/amayben/assemble">Github</a>!</p>
			</div>
			<div style="float: right; width: 74%">
				<table style="height: 99vh; width: 73vw;">
					<tbody>
						<tr>
							<td id="blocklyArea" style="text-align: center"></td>
						</tr>
						<tr>
							<td style="height: 4%; text-align: right">
								<button class="button" onclick="exportworkspace()">Export Blocks</button>
								<button class="button" onclick="check()">Import Blocks</button>
								<input type="file" id="workspaceUpload" accept="text/xml"
									onchange="openFile(event)" style="display: none"/>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
		<div id="blocklyDiv" style="position: absolute"></div>
		<xml xmlns="https://developers.google.com/blockly/xml"
			id="toolbox" style="display: none">
		  <category name="System" colour="#a5745b">
		    <block type="theme">
		      <field name="name">&lt;name&gt;</field>
		      <field name="desc">&lt;description&gt;</field>
		    </block>
		    <block type="function">
		      <field name="name">&lt;name&gt;</field>
		      <field name="desc">&lt;description&gt;</field>
		    </block>
		    <block type="setting">
		      <field name="name">&lt;name&gt;</field>
		    </block>
		  </category>
		  <category name="Setting" colour="#5ba55b">
		    <block type="society">
		      <field name="name">&lt;region, social group, etc.&gt;</field>
		      <field name="desc">&lt;Describe how people in this social group live.&gt;</field>
		    </block>
		    <block type="history">
		      <field name="name">&lt;subject&gt;</field>
		    </block>
		    <block type="era">
		      <field name="name">&lt;name&gt;</field>
		      <field name="desc">&lt;description&gt;</field>
		      <field name="isCurrent">TRUE</field>
		    </block>
		    <block type="entity">
		      <field name="name">&lt;name&gt;</field>
		      <field name="role">&lt;description&gt;</field>
		      <field name="status">&lt;description&gt;</field>
		    </block>
		    <block type="event">
		      <field name="name">&lt;name&gt;</field>
		      <field name="desc">&lt;description&gt;</field>
		      <field name="significance">&lt;significance&gt;</field>
		    </block>
		    <block type="mystery">
		      <field name="name">&lt;name&gt;</field>
		      <field name="desc">&lt;description&gt;</field>
		    </block>
		    <block type="region">
		      <field name="name">&lt;name&gt;</field>
		      <field name="desc">&lt;description&gt;</field>
		      <field name="hasLandmarks">FALSE</field>
		    </block>
		    <block type="landmark">
		      <field name="name">&lt;name&gt;</field>
		      <field name="desc">&lt;description&gt;</field>
		      <field name="significance">&lt;description&gt;</field>
		    </block>
		  </category>
		  <category name="Moves" colour="#995ba5">
		    <block type="factor">
		      <field name="name">&lt;name&gt;</field>
		      <field name="type">Scalar</field>
		      <field name="desc">&lt;description&gt;</field>
		      <field name="isAdditive">FALSE</field>
		    </block>
		    <block type="move">
		      <field name="name">&lt;name&gt;</field>
		      <field name="effect">&lt;effect&gt;</field>
		      <mutation factors=""></mutation>
		      <field name="factors">no_value</field>
		      <field name="desc">&lt;description&gt;</field>
		      <field name="adds_factor">FALSE</field>
		    </block>
		    <block type="playbook_move">
		      <field name="name">&lt;name&gt;</field>
		      <field name="effect">&lt;effect&gt;</field>
		      <mutation factors=""></mutation>
		      <field name="factors">no_value</field>
		      <field name="desc">&lt;description&gt;</field>
		      <field name="adds_factor">FALSE</field>
		    </block>
		    <block type="parameter">
		      <field name="name">&lt;outcome&gt;</field>
		      <field name="lrange">0</field>
		      <field name="rrange">1</field>
		    </block>
		  </category>
		  <category name="Players" colour="#5b67a5">
		    <block type="player_rules">
		    	<field name="hasExtras">FALSE</field>
		    </block>
		    <block type="character_creation"></block>
		    <block type="creation_step">
		      <field name="name">&lt;name&gt;</field>
		      <field name="desc">&lt;description&gt;</field>
		      <mutation factors=""></mutation>
		      <field name="factors">no_value</field>
		    </block>
		    <block type="playbook_creation">
		      <field name="name">no_value</field>
		      <statement name="creation_step">
		        <block type="creation_step">
		          <field name="name">&lt;name&gt;</field>
		          <field name="desc">&lt;description&gt;</field>
		          <mutation factors=""></mutation>
		          <field name="factors">no_value</field>
		        </block>
		      </statement>
		    </block>
		    <block type="playbook">
		      <field name="name">&lt;name&gt;</field>
		      <mutation items=""></mutation>
		      <field name="equipment">no_value</field>
		    </block>
		    <block type="playbook_introduction">
		      <field name="pitch">&lt;description for players&gt;</field>
		      <field name="soc_role">&lt;personality/social interactions&gt;</field>
		      <field name="mech_role">&lt;system/mechanical interactions&gt;</field>
		    </block>
		    <block type="feature">
		      <field name="name">&lt;name&gt;</field>
		      <field name="desc">&lt;description&gt;</field>
		      <mutation factors=""></mutation>
		      <field name="factors">no_value</field>
		    </block>
		   </category>
		   <category name="Equipment" colour="#dd4444">
		   	<block type="equipment"></block>
		    <block type="equipment_type">
		      <field name="name">&lt;name&gt;</field>
		      <field name="desc">&lt;description&gt;</field>
		      <mutation factors=""></mutation>
		      <field name="factors">no_value</field>
		      <field name="hasSubtypes">FALSE</field>
		    </block>
		    <block type="item">
		      <field name="name">&lt;name&gt;</field>
		      <mutation types=""></mutation>
		      <field name="types">no_value</field>
		      <field name="subtypes">no_value</field>
		      <field name="desc">&lt;description&gt;</field>
		  	</block>
		   </category>
		   <category name="Other Mechanics" colour="#a5a55b">
		    <block type="resource">
		      <field name="name">&lt;name&gt;</field>
		      <field name="desc">&lt;description&gt;</field>
		      <mutation factors=""></mutation>
		      <field name="factors">no_value</field>
		      <field name="lrange">0</field>
		      <field name="rrange">1</field>
		      <field name="init">0</field>
		    </block>
		    <block type="extra_mechanic">
		      <field name="name">&lt;name&gt;</field>
		      <field name="desc">&lt;description&gt;</field>
		      <mutation factors=""></mutation>
		      <field name="factors">no_value</field>
		      <field name="hasResources">FALSE</field>
		      <field name="hasMoves">FALSE</field>
		    </block>
		  </category>
		  <category name="" colour="#dddddd"></category>
		  <category name="Examples:" colour="#dddddd"></category>
		  <category name="Apocalypse World" colour="#666666">
	      <block type="theme">
	        <field name="name">Post-Apocalypse</field>
	        <field name="desc">The game is set in a post-apocalyptic wasteland.</field>
	        <statement name="function">
	          <block type="function">
	            <field name="name">Scarcity</field>
	            <field name="desc">The motivations of characters are driven by want due to a lack of resources.</field>
	            <next>
	              <block type="function">
	                <field name="name">Technology</field>
	                <field name="desc">Most technology in the setting is based on the use of scrap metal, or jury-rigging artifacts from the world before.</field>
	                <next>
	                  <block type="function">
	                    <field name="name">The Unknown</field>
	                    <field name="desc">The apocalypse makes both the past and present uncertain, reducing the players' overall sense of security.</field>
	                  </block>
	                </next>
	              </block>
	            </next>
	          </block>
	        </statement>
	      </block>
	      <block type="setting">
	        <field name="name">The Wasteland</field>
	        <statement name="society">
	          <block type="society">
	            <field name="name">The Wasteland</field>
	            <field name="desc">Sparsely populated, struggling, scavenging, built from scraps.</field>
	          </block>
	        </statement>
	        <statement name="history">
	          <block type="history">
	            <field name="name">The Wasteland</field>
	            <statement name="era">
	              <block type="era">
	                <field name="name">The Future</field>
	                <field name="desc">Within a century of an unknown cataclysm.</field>
	                <field name="isCurrent">TRUE</field>
	                <next>
	                  <block type="era">
	                    <field name="name">The Past</field>
	                    <field name="desc">The world as we know it-- or knew it before.</field>
	                    <field name="isCurrent">FALSE</field>
	                  </block>
	                </next>
	              </block>
	            </statement>
	            <statement name="entity">
	              <block type="entity">
	                <field name="name">The Psychic Maelstrom</field>
	                <field name="role">Omnipresent psychic force that has existed ever since the world was changed.</field>
	                <field name="status">Extant and looming</field>
	              </block>
	            </statement>
	            <statement name="event">
	              <block type="event">
	                <field name="name">The Apocalypse</field>
	                <field name="desc">An unknown event that devastated society, killed countless people, and gave rise to the Psychic Maelstrom.</field>
	                <field name="significance">Created the wasteland in which the story is set.</field>
	              </block>
	            </statement>
	          </block>
	        </statement>
	        <statement name="mystery">
	          <block type="mystery">
	            <field name="name">The Apocalypse</field>
	            <field name="desc">What caused it?</field>
	            <next>
	              <block type="mystery">
	                <field name="name">The Psychic Maelstrom</field>
	                <field name="desc">Where did it come from?  What does it want?</field>
	              </block>
	            </next>
	          </block>
	        </statement>
	        <statement name="region">
	          <block type="region">
	            <field name="name">The Wasteland</field>
	            <field name="desc">Barren, dry, and empty. Scattered communities.</field>
	            <field name="hasLandmarks">FALSE</field>
	          </block>
	        </statement>
	      </block>
		  </category>
		</xml>
		<xml xmlns="https://developers.google.com/blockly/xml"
			id="workspaceBlocks" style="display: none">
		  <block type="system">
		    <field name="name">&lt;system name&gt;</field>
		    <statement name="theme">
		      <block type="theme">
		        <field name="name">&lt;name&gt;</field>
		        <field name="desc">&lt;description&gt;</field>
		        <statement name="function">
		          <block type="function">
		            <field name="name">&lt;name&gt;</field>
		            <field name="desc">&lt;description&gt;</field>
		          </block>
		        </statement>
		      </block>
		    </statement>
		    <statement name="setting">
		      <block type="setting">
		        <field name="name">&lt;name&gt;</field>
		        <statement name="society">
		          <block type="society">
		            <field name="name">&lt;region, social group, etc.&gt;</field>
		            <field name="desc">&lt;Describe how people in this social group live.&gt;</field>
		          </block>
		        </statement>
		        <statement name="history">
		          <block type="history">
		            <field name="name">&lt;subject&gt;</field>
		            <statement name="era">
		              <block type="era">
		                <field name="name">&lt;name&gt;</field>
		                <field name="desc">&lt;description&gt;</field>
		                <field name="isCurrent">TRUE</field>
		              </block>
		            </statement>
		            <statement name="entity">
		              <block type="entity">
		                <field name="name">&lt;name&gt;</field>
		                <field name="role">&lt;description&gt;</field>
		                <field name="status">&lt;description&gt;</field>
		              </block>
		            </statement>
		            <statement name="event">
		              <block type="event">
		                <field name="name">&lt;name&gt;</field>
		                <field name="desc">&lt;description&gt;</field>
		                <field name="significance">&lt;significance&gt;</field>
		              </block>
		            </statement>
		          </block>
		        </statement>
		        <statement name="mystery">
		          <block type="mystery">
		            <field name="name">&lt;name&gt;</field>
		            <field name="desc">&lt;description&gt;</field>
		          </block>
		        </statement>
		        <statement name="region">
		          <block type="region">
		            <field name="name">&lt;name&gt;</field>
		            <field name="desc">&lt;description&gt;</field>
		            <field name="hasLandmarks">FALSE</field>
		          </block>
		        </statement>
		      </block>
		    </statement>
		    <statement name="mechanics">
		      <block type="mechanics">
		        <statement name="factor">
		          <block type="factor">
		            <field name="name">&lt;name&gt;</field>
		            <field name="type">Scalar</field>
		            <field name="desc">&lt;description&gt;</field>
		            <field name="isAdditive">FALSE</field>
		          </block>
		        </statement>
		        <statement name="move">
		          <block type="move">
		            <field name="name">&lt;name&gt;</field>
		            <field name="effect">&lt;effect&gt;</field>
		            <mutation factors=""></mutation>
		            <field name="factors">no_value</field>
		            <field name="desc">&lt;description&gt;</field>
		            <field name="adds_factor">FALSE</field>
		          </block>
		        </statement>
		        <field name="hasParameters">FALSE</field>
		        <statement name="player_rules">
		          <block type="player_rules">
		            <statement name="character_creation">
		              <block type="character_creation">
		                <statement name="creation_step">
		                  <block type="creation_step">
		                    <field name="name">&lt;name&gt;</field>
		                    <field name="desc">&lt;description&gt;</field>
		                    <mutation factors=""></mutation>
		                    <field name="factors">no_value</field>
		                  </block>
		                </statement>
		                <statement name="playbook_creation">
		                  <block type="playbook_creation">
		                    <field name="name">no_value</field>
		                    <statement name="creation_step">
		                      <block type="creation_step">
		                        <field name="name">&lt;name&gt;</field>
		                        <field name="desc">&lt;description&gt;</field>
		                        <mutation factors=""></mutation>
		                        <field name="factors">no_value</field>
		                      </block>
		                    </statement>
		                  </block>
		                </statement>
		              </block>
		            </statement>
		            <statement name="playbook">
		              <block type="playbook">
		                <field name="name">&lt;name&gt;</field>
		                <mutation items=""></mutation>
		                <field name="equipment">no_value</field>
		                <statement name="playbook_introduction">
		                  <block type="playbook_introduction">
		                    <field name="pitch">&lt;description for players&gt;</field>
		                    <field name="soc_role">&lt;personality/social interactions&gt;</field>
		                    <field name="mech_role">&lt;system/mechanical interactions&gt;</field>
		                  </block>
		                </statement>
		                <statement name="feature">
		                  <block type="feature">
		                    <field name="name">&lt;name&gt;</field>
		                    <field name="desc">&lt;description&gt;</field>
		                    <mutation factors=""></mutation>
		                    <field name="factors">no_value</field>
		                  </block>
		                </statement>
		              </block>
		            </statement>
		            <statement name="resource">
		              <block type="resource">
		                <field name="name">&lt;name&gt;</field>
		                <field name="desc">&lt;description&gt;</field>
		                <mutation factors=""></mutation>
		                <field name="factors">no_value</field>
		                <field name="lrange">0</field>
		                <field name="rrange">1</field>
		                <field name="init">0</field>
		              </block>
		            </statement>
		            <statement name="equipment">
		              <block type="equipment">
		                <statement name="equipment_type">
		                  <block type="equipment_type">
		                    <field name="name">&lt;name&gt;</field>
		                    <field name="desc">&lt;description&gt;</field>
		                    <mutation factors=""></mutation>
		                    <field name="factors">no_value</field>
		                    <field name="hasSubtypes">FALSE</field>
		                  </block>
		                </statement>
		                <statement name="item">
		                  <block type="item">
		                    <field name="name">&lt;name&gt;</field>
		                    <mutation types=""></mutation>
		                    <field name="types">no_value</field>
		                    <field name="subtypes">no_value</field>
		                    <field name="desc">&lt;description&gt;</field>
		                  </block>
		                </statement>
		              </block>
		            </statement>
		            <field name="hasExtras">FALSE</field>
		          </block>
		        </statement>
		      </block>
		    </statement>
		  </block>
		</xml>
	</body>
	<script>
	  var blocklyArea = document.getElementById('blocklyArea');
	  var blocklyDiv = document.getElementById('blocklyDiv');
	  var options = {
		toolbox : document.getElementById('toolbox'),
		collapse : true,
		comments : true,
		disable : true,
		maxBlocks : Infinity,
		trashcan : true,
		horizontalLayout : false,
		toolboxPosition : 'start',
		css : true,
		media : 'https://blockly-demo.appspot.com/static/media/',
		rtl : false,
		scrollbars : true,
		sounds : true,
		oneBasedIndex : true,
		zoom : {
			controls : true,
			wheel : true,
			startScale : 0.5,
			maxScale : 3,
			minScale : 0.3,
			scaleSpeed : 1.1
		}
	  };
	  var workspace = Blockly.inject(blocklyDiv, options);
	  var workspaceBlocks = document.getElementById("workspaceBlocks");
		var workspaceUpload = document.getElementById("workspaceUpload");
		/* Load blocks to workspace. */
	  //TODO: if cookie is present, load XML from cookie instead of workspaceBlocks
	  Blockly.Xml.domToWorkspace(workspaceBlocks, workspace);
	  var exportworkspace = function() {
	  	var filename = prompt("Filename for workspace XML:", "system.xml");
			if (filename.endsWith(".xml")) {
			  var xml = Blockly.Xml.workspaceToDom(workspace);
				var xml_text = Blockly.Xml.domToPrettyText(xml);
				download(xml_text, filename, "text/plain");
			}
	  };
	  var check = function() {
	  	var answer = confirm("Import workspace? (WARNING: This will delete your current workspace)");
	  	if (answer) loadworkspace();
	  }
	  var loadworkspace = function() {
	  	workspaceUpload.click();
	  };
	  var openFile = function(event) {
	  	var input = event.target;
	  	var reader = new FileReader();
	  	reader.onload = function() {
	  		workspace.clear();
	  		var xml = Blockly.Xml.textToDom(reader.result);
	  		Blockly.Xml.domToWorkspace(xml, workspace);
	  	};
	  	reader.readAsText(input.files[0]);
	  };
	  //TODO: returns workspace to default state
	  /*
	  var resetworkspace = function() {

	  };
	  */
	  //TODO: saves workspace to cookie (automatic?)
	  /*
	  var workspacetocookie = function() {

	  };
	  */
	  var onresize = function(e) {
	    // Compute the absolute coordinates and dimensions of blocklyArea.
	    var element = blocklyArea;
	    var x = 0;
	    var y = 0;
	    do {
	      x += element.offsetLeft;
	      y += element.offsetTop;
	      element = element.offsetParent;
	    } while (element);
	    // Position blocklyDiv over blocklyArea.
	    blocklyDiv.style.left = x + 'px';
	    blocklyDiv.style.top = y + 'px';
	    blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
	    blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';
	    Blockly.svgResize(workspace);
	  };
	  window.addEventListener('resize', onresize, false);
	  onresize();
	  Blockly.svgResize(workspace);
	</script>
</html>